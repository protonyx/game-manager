<mat-card class="player-list-card">
  <mat-card-header>
    <mat-card-title>Players</mat-card-title>
    <!-- Player list actions menu in header -->
    <button
      *ngIf="isHost"
      mat-icon-button
      [matMenuTriggerFor]="menu"
      aria-label="Host actions">
      <mat-icon>more_vert</mat-icon>
    </button>
    <mat-menu #menu="matMenu">
      <button mat-menu-item (click)="handleReorderPlayers()">
        <mat-icon>sort</mat-icon>
        <span>Reorder Players</span>
      </button>
    </mat-menu>
  </mat-card-header>

  <mat-card-content>
  <!-- Search input - only show when there are more than 10 players -->
  <mat-form-field class="search-field" *ngIf="dataSource.data.length > 10">
    <mat-label>Search players</mat-label>
    <input matInput [(ngModel)]="searchText" (keyup)="applyFilter($event)" placeholder="Search by name">
    <mat-icon matSuffix>search</mat-icon>
  </mat-form-field>

  <!-- Card-based player list -->
  <div class="player-cards-container">
    <mat-card *ngFor="let player of filteredPlayers"
              class="player-card"
              [class.player-is-active]="checkIsPlayerTurn(player)"
              [ngStyle]="{'border-left-color': getPlayerColor(player)}">
      <mat-card-header>
        <div mat-card-avatar
             class="player-avatar"
             [ngStyle]="{'background-color': getPlayerColor(player)}">
          {{ player.order }}
        </div>
        <mat-card-title>
          {{ player.name }}
          <span *ngIf="checkIsMe(player)" class="me-indicator">(me)</span>
          <mat-icon *ngIf="player.state === 'Disconnected'" class="disconnected-icon">signal_wifi_off</mat-icon>
        </mat-card-title>
        <mat-card-subtitle *ngIf="checkIsPlayerTurn(player)" class="turn-indicator">Current Turn</mat-card-subtitle>
        <!-- Player actions menu in header -->
        <button
          *ngIf="isHost || (game?.state === 'Preparing' && checkIsMe(player))"
          mat-icon-button
          [matMenuTriggerFor]="menu"
          aria-label="Player actions">
          <mat-icon>more_vert</mat-icon>
        </button>
        <mat-menu #menu="matMenu">
          <button mat-menu-item (click)="handleEditPlayer(player)">
            <mat-icon>edit</mat-icon>
            <span>Edit</span>
          </button>
          <!-- Only show kick option for host -->
          <button mat-menu-item *ngIf="isHost" (click)="handleKickPlayer(player)">
            <mat-icon>person_remove</mat-icon>
            <span>Kick</span>
          </button>
        </mat-menu>
      </mat-card-header>

      <mat-card-content>
        <!-- Player trackers - only show when game is not in Preparing state -->
        <div class="tracker-list" *ngIf="trackers.length > 0 && game?.state !== 'Preparing'">
          @for (tracker of trackers; track tracker.id) {
          <div class="tracker-item">
            <span class="tracker-name">{{ tracker.name }}:</span>
            @if (currentPlayer === player) {
            <button mat-button (click)="handleEditTracker(player.id, tracker.id)">{{ getTrackerValue(player, tracker.id) }}</button>
            } @else {
            <span class="tracker-value">{{ getTrackerValue(player, tracker.id) }}</span>
            }
          </div>
          }
        </div>
      </mat-card-content>
    </mat-card>
  </div>

  <!-- No results message -->
  <div *ngIf="filteredPlayers.length === 0" class="no-results">
    No players found matching "{{ searchText }}"
  </div>

  <!-- Pagination - only show when there's more than 1 page worth of results -->
  <mat-paginator
    *ngIf="dataSource.data.length > pageSize"
    [length]="dataSource.data.length"
    [pageSize]="pageSize"
    [pageSizeOptions]="pageSizeOptions"
    aria-label="Select page">
  </mat-paginator>

  </mat-card-content>
</mat-card>
