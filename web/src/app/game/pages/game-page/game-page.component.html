<ng-container
  *ngrxLet="{
    game: game$,
    currentPlayer: currentPlayer$,
    trackers: trackers$,
    cols: cols$,
    leftColSpan: leftColSpan$,
    rightColSpan: rightColSpan$
  } as vm">
  <div class="game-page-container">
    <!-- Responsive grid layout -->
    <div class="game-grid" [ngClass]="{'single-column': vm.cols === 1, 'two-columns': vm.cols === 2, 'preparing-state': vm.game?.state === 'Preparing'}">

      <!-- Left column (players and game control) -->
      <div class="left-column">
        <!-- Game Control (only for host) -->
        <app-game-control
          *ngIf="isHost$ | async" class="game-control-card"
          [game]="vm.game"
          [isHost]="isHost$ | async"
          (startGame)="onStartGame(vm.game)"
          (advanceTurn)="onEndTurn(vm.game)"
          (endGame)="onEndGame(vm.game)">
        </app-game-control>

        <!-- Player List -->
        <app-player-list
          [game]="vm.game"
          [players]="players$ | async"
          [currentPlayer]="vm.currentPlayer"
          [isHost]="isHost$ | async"
          (editPlayer)="onPlayerEdit($event)"
          (kickPlayer)="onPlayerKick($event)"
          (reorder)="onReorder()">
        </app-player-list>
      </div>

      <!-- Right column (current turn and trackers) -->
      <div class="right-column">
        <!-- Current Turn -->
          <app-current-turn
                  *ngIf="vm.game && vm.game.state === 'InProgress' && vm.currentPlayer"
                  [game]="vm.game"
                  [players]="players$ | async"
                  [currentPlayer]="vm.currentPlayer"
                  [isHost]="isHost$ | async"
                  (endTurn)="onEndTurn(vm.game)">
          </app-current-turn>

          <!-- Trackers -->
          <app-tracker-editor
            *ngIf="vm.game?.state === 'InProgress' && vm.trackers && vm.trackers.length > 0 && vm.currentPlayer"
            [trackers]="vm.trackers"
            [player]="vm.currentPlayer"
            (updateTrackers)="onTrackerUpdate(vm.currentPlayer, $event)">
          </app-tracker-editor>
      </div>
    </div>
  </div>
</ng-container>
