<ng-container
  *ngrxLet="{
    game: game$,
    currentPlayer: currentPlayer$,
    trackers: trackers$,
    cols: cols$,
    leftColSpan: leftColSpan$,
    rightColSpan: rightColSpan$
  } as vm">
  <div class="game-page-container">
    <!-- Responsive grid layout -->
    <div class="game-grid" [ngClass]="{'single-column': vm.cols === 1, 'two-columns': vm.cols === 2}">

      <!-- Left column (players and game control) -->
      <div class="left-column">
        <!-- Game Control (only for host) -->
        <mat-card *ngIf="isHost$ | async" class="game-control-card">
          <mat-card-header>
            <mat-card-title>Game Control</mat-card-title>
          </mat-card-header>
          <mat-card-content>
            <app-game-control
              [game]="vm.game"
              [isHost]="isHost$ | async"
              (startGame)="onStartGame(vm.game)"
              (advanceTurn)="onEndTurn(vm.game)"
              (endGame)="onEndGame(vm.game)">
            </app-game-control>
          </mat-card-content>
        </mat-card>

        <!-- Player List -->
        <mat-card class="player-list-card">
          <mat-card-header>
            <mat-card-title>Player List</mat-card-title>
          </mat-card-header>
          <mat-card-content>
            <app-player-list
              [game]="vm.game"
              [players]="players$ | async"
              [currentPlayer]="vm.currentPlayer"
              [isHost]="isHost$ | async"
              (editPlayer)="onPlayerEdit($event)"
              (kickPlayer)="onPlayerKick($event)">
            </app-player-list>
          </mat-card-content>
          <mat-card-actions *ngIf="isHost$ | async">
            <button mat-button color="primary" (click)="onReorder()">
              Reorder
            </button>
          </mat-card-actions>
        </mat-card>
      </div>

      <!-- Right column (current turn and trackers) -->
      <div class="right-column">
        <!-- Current Turn -->
        <mat-card 
          *ngIf="vm.game && vm.game.state === 'InProgress' && vm.currentPlayer"
          class="current-turn-card">
          <mat-card-header>
            <mat-card-title>Current Turn</mat-card-title>
          </mat-card-header>
          <mat-card-content>
            <app-current-turn
              [game]="vm.game"
              [players]="players$ | async"
              [currentPlayer]="vm.currentPlayer"
              [isHost]="isHost$ | async"
              (endTurn)="onEndTurn(vm.game)">
            </app-current-turn>
          </mat-card-content>
        </mat-card>

        <!-- Trackers -->
        <mat-card 
          *ngIf="vm.game?.state === 'InProgress' && vm.trackers && vm.trackers.length > 0 && vm.currentPlayer"
          class="trackers-card">
          <mat-card-header>
            <mat-card-title>Trackers</mat-card-title>
          </mat-card-header>
          <mat-card-content>
            <app-tracker-editor
              [trackers]="vm.trackers"
              [player]="vm.currentPlayer"
              (updateTrackers)="onTrackerUpdate(vm.currentPlayer, $event)">
            </app-tracker-editor>
          </mat-card-content>
        </mat-card>
      </div>
    </div>
  </div>
</ng-container>
